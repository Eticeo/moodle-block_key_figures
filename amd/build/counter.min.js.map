{"version":3,"file":"counter.min.js","sources":["../src/counter.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Key Figures Block Counter Animation.\r\n *\r\n * This module handles the counter animation for key figures in the block.\r\n *\r\n * @module     block_key_figures/counter\r\n * @package    block_key_figures\r\n * @copyright  2026 Jan Eticeo <contact@eticeo.fr>\r\n * @author     2026 Feb Belgrand Laureen <laureen.belgrand@eticeo.fr>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n/**\r\n * Initialize counter animations for all key figure blocks.\r\n */\r\nexport const init = () => {\r\n    // Use a function to ensure DOM is ready.\r\n    const initializeCounters = () => {\r\n        const elements = document.querySelectorAll(\".block_key_figures.block .col-number\");\r\n        \r\n        elements.forEach((element) => {\r\n            const finalresult = element.innerHTML;\r\n            let newresult = finalresult;\r\n\r\n            // Extract and process numbers.\r\n            const allregexnums = {};\r\n            const allregexsteps = {};\r\n            const matchesnum = finalresult.match(/[0-9]+/g);\r\n            const numberblockid = element.id;\r\n\r\n            let index = null;\r\n            if (matchesnum) {\r\n                matchesnum.forEach((match, num) => {\r\n                    const regexnum = new RegExp(match, \"g\");\r\n                    index = \"##regex\" + num + \"##\";\r\n                    newresult = newresult.replace(regexnum, index);\r\n                    allregexnums[index] = parseInt(match, 10);\r\n                    allregexsteps[index] = getStep(parseInt(match, 10));\r\n                });\r\n            }\r\n\r\n            // Start animation if numbers were found.\r\n            if (index !== null) {\r\n                increment(\r\n                    numberblockid,\r\n                    0,\r\n                    allregexnums,\r\n                    allregexsteps,\r\n                    finalresult,\r\n                    newresult\r\n                );\r\n            }\r\n        });\r\n    };\r\n\r\n    // Check if DOM is already loaded.\r\n    if (document.readyState === 'loading') {\r\n        document.addEventListener(\"DOMContentLoaded\", initializeCounters);\r\n    } else {\r\n        // DOM is already loaded.\r\n        initializeCounters();\r\n    }\r\n};\r\n\r\n/**\r\n * Calculate the step size for counter animation.\r\n *\r\n * @param {number} number The target number to reach.\r\n * @returns {number} The step size for the animation.\r\n */\r\nconst getStep = (number) => {\r\n    const step = Math.floor(number / 100);\r\n    return step > 0 ? step : 1;\r\n};\r\n\r\n/**\r\n * Animate the counter increment.\r\n *\r\n * @param {string} numberblockid ID of the number block element.\r\n * @param {number} num Current counter value.\r\n * @param {Object} allregexnums Object mapping regex placeholders to their target values.\r\n * @param {Object} allregexsteps Object mapping regex placeholders to their step values.\r\n * @param {string} finalresult The final text to display.\r\n * @param {string} newresult The intermediate text with placeholders.\r\n */\r\nconst increment = (\r\n    numberblockid,\r\n    num,\r\n    allregexnums,\r\n    allregexsteps,\r\n    finalresult,\r\n    newresult\r\n) => {\r\n    num += 1;\r\n    let isfinalresult = true;\r\n    let newresultnum = newresult;\r\n\r\n    // Update each number in the text.\r\n    for (const regexnum in allregexnums) {\r\n        if (Object.prototype.hasOwnProperty.call(allregexnums, regexnum)) {\r\n            const reg = new RegExp(regexnum, \"g\");\r\n            let replacenum = num * allregexsteps[regexnum];\r\n\r\n            if (replacenum <= allregexnums[regexnum]) {\r\n                isfinalresult = false;\r\n            } else {\r\n                replacenum = allregexnums[regexnum];\r\n            }\r\n            newresultnum = newresultnum.replace(reg, replacenum);\r\n        }\r\n    }\r\n\r\n    // Update the element.\r\n    const element = document.getElementById(numberblockid);\r\n    if (element) {\r\n        element.innerHTML = newresultnum;\r\n    }\r\n\r\n    // Continue animation if not finished.\r\n    if (!isfinalresult) {\r\n        setTimeout(() => {\r\n            increment(\r\n                numberblockid,\r\n                num,\r\n                allregexnums,\r\n                allregexsteps,\r\n                finalresult,\r\n                newresult\r\n            );\r\n        }, 10);\r\n    }\r\n};\r\n\r\n"],"names":["initializeCounters","document","querySelectorAll","forEach","element","finalresult","innerHTML","newresult","allregexnums","allregexsteps","matchesnum","match","numberblockid","id","index","num","regexnum","RegExp","replace","parseInt","getStep","increment","readyState","addEventListener","number","step","Math","floor","isfinalresult","newresultnum","Object","prototype","hasOwnProperty","call","reg","replacenum","getElementById","setTimeout"],"mappings":"8JA8BoB,WAEVA,mBAAqB,KACNC,SAASC,iBAAiB,wCAElCC,SAASC,gBACRC,YAAcD,QAAQE,cACxBC,UAAYF,kBAGVG,aAAe,GACfC,cAAgB,GAChBC,WAAaL,YAAYM,MAAM,WAC/BC,cAAgBR,QAAQS,OAE1BC,MAAQ,KACRJ,YACAA,WAAWP,SAAQ,CAACQ,MAAOI,aACjBC,SAAW,IAAIC,OAAON,MAAO,KACnCG,MAAQ,UAAYC,IAAM,KAC1BR,UAAYA,UAAUW,QAAQF,SAAUF,OACxCN,aAAaM,OAASK,SAASR,MAAO,IACtCF,cAAcK,OAASM,QAAQD,SAASR,MAAO,QAKzC,OAAVG,OACAO,UACIT,cACA,EACAJ,aACAC,cACAJ,YACAE,eAOY,YAAxBN,SAASqB,WACTrB,SAASsB,iBAAiB,mBAAoBvB,oBAG9CA,4BAUFoB,QAAWI,eACPC,KAAOC,KAAKC,MAAMH,OAAS,YAC1BC,KAAO,EAAIA,KAAO,GAavBJ,UAAY,CACdT,cACAG,IACAP,aACAC,cACAJ,YACAE,aAEAQ,KAAO,MACHa,eAAgB,EAChBC,aAAetB,cAGd,MAAMS,YAAYR,gBACfsB,OAAOC,UAAUC,eAAeC,KAAKzB,aAAcQ,UAAW,OACxDkB,IAAM,IAAIjB,OAAOD,SAAU,SAC7BmB,WAAapB,IAAMN,cAAcO,UAEjCmB,YAAc3B,aAAaQ,UAC3BY,eAAgB,EAEhBO,WAAa3B,aAAaQ,UAE9Ba,aAAeA,aAAaX,QAAQgB,IAAKC,kBAK3C/B,QAAUH,SAASmC,eAAexB,eACpCR,UACAA,QAAQE,UAAYuB,cAInBD,eACDS,YAAW,KACPhB,UACIT,cACAG,IACAP,aACAC,cACAJ,YACAE,aAEL"}